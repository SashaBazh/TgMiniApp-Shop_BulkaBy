<div class="discounts-container">
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
  <div
    *ngIf="message"
    class="notification"
    [ngClass]="{ success: isSuccess, error: !isSuccess }"
  >
    <span>{{ message }}</span>
    <button class="close-btn" (click)="closeNotification()">√ó</button>
  </div>

  <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–∏–¥–∫–∏ -->
  <section class="create-discount bg-light rounded mb-4 p-4">
    <h1 class="mb-4">
      {{ isEditing ? "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ü–∏—é" : "–°–æ–∑–¥–∞—Ç—å –∞–∫—Ü–∏—é" }}
    </h1>
    <form [formGroup]="discountForm" (ngSubmit)="submitDiscountForm()">
      <div class="form-group mb-3">
        <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        <input
          id="name"
          class="form-control"
          formControlName="name"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏"
        />
      </div>
      <div class="form-group mb-3">
        <label for="discount_percentage" class="form-label"
          >–ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏</label
        >
        <input
          id="discount_percentage"
          type="number"
          class="form-control"
          formControlName="discount_percentage"
          step="0.01"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ (0-1)"
        />
      </div>
      <div class="form-group mb-3">
        <label for="start_date" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
        <input
          id="start_date"
          type="date"
          class="form-control"
          formControlName="start_date"
        />
      </div>
      <div class="form-group mb-3">
        <label for="end_date" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
        <input
          id="end_date"
          type="date"
          class="form-control"
          formControlName="end_date"
        />
      </div>

      <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
      <div class="form-group mb-3">
        <label for="category_id" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select
          id="category_id"
          class="form-control"
          formControlName="category_id"
          (change)="onCategoryChange($event)"
        >
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
      </div>

      <!-- –í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞ -->
      <div class="form-group mb-3">
        <label for="product_id" class="form-label">–¢–æ–≤–∞—Ä</label>
        <select
          id="product_id"
          class="form-control"
          formControlName="product_id"
          [disabled]="!products.length"
        >
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä</option>
          <option *ngFor="let product of products" [value]="product.id">
            {{ product.name }}
          </option>
        </select>
      </div>

      <div class="form-group mb-3">
        <label for="min_quantity" class="form-label"
          >–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</label
        >
        <input
          id="min_quantity"
          type="number"
          class="form-control"
          formControlName="min_quantity"
        />
      </div>
      <div class="form-group mb-3">
        <label for="max_quantity" class="form-label"
          >–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</label
        >
        <input
          id="max_quantity"
          type="number"
          class="form-control"
          formControlName="max_quantity"
        />
      </div>
      <button
        type="submit"
        class="mocha-button"
        [disabled]="discountForm.invalid"
      >
        {{ isEditing ? "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" : "–°–æ–∑–¥–∞—Ç—å –∞–∫—Ü–∏—é" }}
      </button>
    </form>
  </section>

  <!-- –°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫ -->
  <section class="mocha-discount-section">
    <h2 class="mocha-section-title">–°–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π</h2>

    <div
      *ngIf="discounts.length > 0; else noDiscounts"
      class="mocha-discount-grid"
    >
      <div *ngFor="let discount of discounts" class="mocha-discount-card">
        <div class="mocha-discount-content">
          <h3 class="mocha-discount-title">{{ discount.name }}</h3>
          <p class="mocha-discount-percentage">
            <span class="mocha-percentage-badge"
              >{{ discount.discount_percentage * 100 }}%</span
            >
          </p>
          <p class="mocha-discount-dates">
            <i class="mocha-date-icon">üìÖ</i>
            {{ formatDisplayDate(discount.start_date) }} ‚Äî
            {{ formatDisplayDate(discount.end_date) }}
          </p>
          <div class="mocha-discount-actions">
            <button class="mocha-edit-btn" (click)="editDiscount(discount)">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button
              class="mocha-delete-btn"
              (click)="deleteDiscount(discount.id)"
            >
              –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noDiscounts>
      <div class="mocha-empty-state">
        <p>–ê–∫—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
      </div>
    </ng-template>
  </section>
</div>
